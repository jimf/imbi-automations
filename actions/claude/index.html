
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../callable/">
      
      
        <link rel="next" href="../docker/">
      
      
        
      
      
      <link rel="icon" href="../../logo.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Claude - Imbi Automations</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#claude-actions" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Imbi Automations" class="md-header__button md-logo" aria-label="Imbi Automations" data-md-component="logo">
      
  <img src="../../logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Imbi Automations
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Claude
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/AWeber-Imbi/imbi-automations" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    AWeber-Imbi/imbi-automations
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../architecture/" class="md-tabs__link">
        
  
  
    
  
  Architecture

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../configuration/" class="md-tabs__link">
          
  
  
  Configuration

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../docker/" class="md-tabs__link">
        
  
  
    
  
  Docker

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../workflows/" class="md-tabs__link">
          
  
  
  Workflows

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../cli/" class="md-tabs__link">
        
  
  
    
  
  CLI Reference

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Imbi Automations" class="md-nav__button md-logo" aria-label="Imbi Automations" data-md-component="logo">
      
  <img src="../../logo.svg" alt="logo">

    </a>
    Imbi Automations
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/AWeber-Imbi/imbi-automations" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    AWeber-Imbi/imbi-automations
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Configuration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration File
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../environment-variables/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Environment Variables
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../docker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Docker
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Workflows
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Workflows
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workflows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workflow-configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workflow-filters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Filters
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../workflow-conditions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Conditions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../path-schemes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Path Schemes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_6" checked>
        
          
          <label class="md-nav__link" for="__nav_5_6" id="__nav_5_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Actions
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Actions
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    About Actions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stages/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Action Stages
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../callable/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Callable
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Claude
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Claude
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fields" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fields
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Fields">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#planning_prompt-optional" class="md-nav__link">
    <span class="md-ellipsis">
      
        planning_prompt (optional)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task_prompt-required" class="md-nav__link">
    <span class="md-ellipsis">
      
        task_prompt (required)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validation_prompt-optional" class="md-nav__link">
    <span class="md-ellipsis">
      
        validation_prompt (optional)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#max_cycles-optional" class="md-nav__link">
    <span class="md-ellipsis">
      
        max_cycles (optional)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#on_failure-optional" class="md-nav__link">
    <span class="md-ellipsis">
      
        on_failure (optional)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ai_commit-optional" class="md-nav__link">
    <span class="md-ellipsis">
      
        ai_commit (optional)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#planning-agent-feature" class="md-nav__link">
    <span class="md-ellipsis">
      
        Planning Agent Feature
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Planning Agent Feature">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#when-to-use-planning" class="md-nav__link">
    <span class="md-ellipsis">
      
        When to Use Planning
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#planning-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Planning Workflow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#planning-error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Planning Error Handling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-with-planning" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example with Planning
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prompt-context" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prompt Context
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    <span class="md-ellipsis">
      
        Examples
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-code-transformation-without-planning" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basic Code Transformation (Without Planning)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-cycle-transformation-with-retry" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multi-Cycle Transformation with Retry
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#with-validator-no-planning" class="md-nav__link">
    <span class="md-ellipsis">
      
        With Validator (No Planning)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#complex-transformation-without-planning" class="md-nav__link">
    <span class="md-ellipsis">
      
        Complex Transformation (Without Planning)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prompt-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prompt Best Practices
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Prompt Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clear-objectives" class="md-nav__link">
    <span class="md-ellipsis">
      
        Clear Objectives
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#specific-instructions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Specific Instructions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#successfailure-criteria" class="md-nav__link">
    <span class="md-ellipsis">
      
        Success/Failure Criteria
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#project-context-usage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Project Context Usage
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#failure-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Failure Handling
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Failure Handling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#failure-files" class="md-nav__link">
    <span class="md-ellipsis">
      
        Failure Files
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retry-mechanism" class="md-nav__link">
    <span class="md-ellipsis">
      
        Retry Mechanism
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-context-in-retries" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error Context in Retries
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-usage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Advanced Usage
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conditional-prompts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Conditional Prompts
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-stage-transformations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multi-Stage Transformations
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#with-prepost-actions" class="md-nav__link">
    <span class="md-ellipsis">
      
        With Pre/Post Actions
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integration-with-other-actions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Integration with Other Actions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Integration with Other Actions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#claude-shell-test-verification" class="md-nav__link">
    <span class="md-ellipsis">
      
        Claude + Shell (Test Verification)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#claude-file-template-application" class="md-nav__link">
    <span class="md-ellipsis">
      
        Claude + File (Template Application)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#claude-git-commit-verification" class="md-nav__link">
    <span class="md-ellipsis">
      
        Claude + Git (Commit Verification)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mcp-servers" class="md-nav__link">
    <span class="md-ellipsis">
      
        MCP Servers
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MCP Servers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#available-servers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Available Servers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-database-access" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example: Database Access
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#environment-variables-in-mcp-configs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Environment Variables in MCP Configs
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Performance Considerations
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security Considerations
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-notes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implementation Notes
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../docker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Docker
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../file/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    File
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../git/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Git
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../github/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    GitHub
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../imbi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Imbi
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../shell/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Shell
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../template/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Template
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../templating/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Templating
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../debugging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Debugging
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CLI Reference
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fields" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fields
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Fields">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#planning_prompt-optional" class="md-nav__link">
    <span class="md-ellipsis">
      
        planning_prompt (optional)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task_prompt-required" class="md-nav__link">
    <span class="md-ellipsis">
      
        task_prompt (required)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validation_prompt-optional" class="md-nav__link">
    <span class="md-ellipsis">
      
        validation_prompt (optional)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#max_cycles-optional" class="md-nav__link">
    <span class="md-ellipsis">
      
        max_cycles (optional)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#on_failure-optional" class="md-nav__link">
    <span class="md-ellipsis">
      
        on_failure (optional)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ai_commit-optional" class="md-nav__link">
    <span class="md-ellipsis">
      
        ai_commit (optional)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#planning-agent-feature" class="md-nav__link">
    <span class="md-ellipsis">
      
        Planning Agent Feature
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Planning Agent Feature">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#when-to-use-planning" class="md-nav__link">
    <span class="md-ellipsis">
      
        When to Use Planning
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#planning-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Planning Workflow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#planning-error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Planning Error Handling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-with-planning" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example with Planning
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prompt-context" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prompt Context
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    <span class="md-ellipsis">
      
        Examples
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-code-transformation-without-planning" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basic Code Transformation (Without Planning)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-cycle-transformation-with-retry" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multi-Cycle Transformation with Retry
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#with-validator-no-planning" class="md-nav__link">
    <span class="md-ellipsis">
      
        With Validator (No Planning)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#complex-transformation-without-planning" class="md-nav__link">
    <span class="md-ellipsis">
      
        Complex Transformation (Without Planning)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prompt-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prompt Best Practices
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Prompt Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clear-objectives" class="md-nav__link">
    <span class="md-ellipsis">
      
        Clear Objectives
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#specific-instructions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Specific Instructions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#successfailure-criteria" class="md-nav__link">
    <span class="md-ellipsis">
      
        Success/Failure Criteria
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#project-context-usage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Project Context Usage
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#failure-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Failure Handling
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Failure Handling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#failure-files" class="md-nav__link">
    <span class="md-ellipsis">
      
        Failure Files
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retry-mechanism" class="md-nav__link">
    <span class="md-ellipsis">
      
        Retry Mechanism
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-context-in-retries" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error Context in Retries
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-usage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Advanced Usage
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conditional-prompts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Conditional Prompts
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-stage-transformations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multi-Stage Transformations
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#with-prepost-actions" class="md-nav__link">
    <span class="md-ellipsis">
      
        With Pre/Post Actions
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integration-with-other-actions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Integration with Other Actions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Integration with Other Actions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#claude-shell-test-verification" class="md-nav__link">
    <span class="md-ellipsis">
      
        Claude + Shell (Test Verification)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#claude-file-template-application" class="md-nav__link">
    <span class="md-ellipsis">
      
        Claude + File (Template Application)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#claude-git-commit-verification" class="md-nav__link">
    <span class="md-ellipsis">
      
        Claude + Git (Commit Verification)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mcp-servers" class="md-nav__link">
    <span class="md-ellipsis">
      
        MCP Servers
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MCP Servers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#available-servers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Available Servers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-database-access" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example: Database Access
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#environment-variables-in-mcp-configs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Environment Variables in MCP Configs
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Performance Considerations
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security Considerations
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-notes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implementation Notes
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="claude-actions">Claude Actions<a class="headerlink" href="#claude-actions" title="Permanent link">&para;</a></h1>
<p>Claude actions leverage the <a href="https://docs.claude.com/en/api/agent-sdk/overview">Claude Agent SDK</a> for AI-powered code transformations, enabling complex multi-file analysis and intelligent code modifications that would be difficult or error-prone with traditional approaches.</p>
<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">[[actions]]</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;action-name&quot;</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;claude&quot;</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="n">planning_prompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;prompts/planning.md&quot;</span><span class="w">         </span><span class="c1"># Optional - enables planning phase</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="n">task_prompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;prompts/task.md&quot;</span><span class="w">                 </span><span class="c1"># Required (formerly &#39;prompt&#39;)</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="n">validation_prompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;prompts/validate.md&quot;</span><span class="w">       </span><span class="c1"># Optional</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="n">max_cycles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w">                                  </span><span class="c1"># Optional, default: 3</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="n">on_failure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;cleanup-action&quot;</span><span class="w">                   </span><span class="c1"># Optional</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="n">ai_commit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="w">                                </span><span class="c1"># Optional, default: true</span>
</code></pre></div>
<h2 id="fields">Fields<a class="headerlink" href="#fields" title="Permanent link">&para;</a></h2>
<h3 id="planning_prompt-optional">planning_prompt (optional)<a class="headerlink" href="#planning_prompt-optional" title="Permanent link">&para;</a></h3>
<p>Path to Jinja2 template file containing the planning prompt for the planning agent.</p>
<p><strong>Type:</strong> <code>string</code> (path relative to workflow directory)  </p>
<p><strong>Format:</strong> Jinja2 template (<code>.j2</code> extension) or plain markdown  </p>
<p><strong>Location:</strong> Relative to workflow directory (e.g., <code>prompts/planning.md</code>)  </p>
<p><strong>When Provided:</strong>  </p>
<ul>
<li>Enables three-phase execution: Planning → Task → Validation</li>
<li>Planning agent analyzes codebase before task agent makes changes</li>
<li>Returns structured plan that gets injected into task prompt</li>
<li>Plan regenerated fresh at start of each cycle</li>
</ul>
<p><strong>Agent Tools:</strong> Read, Glob, Grep, Bash (read-only operations)  </p>
<p><strong>Response Format:</strong> <code>mcp__agent_tools__submit_planning_response(plan=[...], analysis="...")</code>  </p>
<h3 id="task_prompt-required">task_prompt (required)<a class="headerlink" href="#task_prompt-required" title="Permanent link">&para;</a></h3>
<p>Path to Jinja2 template file containing the task prompt for Claude (formerly named <code>prompt</code>).</p>
<p><strong>Type:</strong> <code>string</code> (path relative to workflow directory)  </p>
<p><strong>Format:</strong> Jinja2 template (<code>.j2</code> extension) or plain markdown  </p>
<p><strong>Location:</strong> Relative to workflow directory (e.g., <code>prompts/update-python.md</code>)  </p>
<p><strong>Working Directory:</strong> Claude SDK runs in <code>working_directory/repository/</code> subdirectory  </p>
<p><strong>Agent Tools:</strong> Read, Write, Edit, Bash (write operations allowed)  </p>
<p><strong>Response Format:</strong> <code>mcp__agent_tools__submit_task_response(message="...")</code>  </p>
<h3 id="validation_prompt-optional">validation_prompt (optional)<a class="headerlink" href="#validation_prompt-optional" title="Permanent link">&para;</a></h3>
<p>Path to validation prompt template. If provided, Claude will run a validation cycle after the task cycle.</p>
<p><strong>Type:</strong> <code>string</code> (path relative to workflow directory)  </p>
<p><strong>Format:</strong> Jinja2 template (<code>.j2</code> extension) or plain markdown  </p>
<p><strong>Agent Tools:</strong> Read, Bash (read-only verification)  </p>
<p><strong>Response Format:</strong> <code>mcp__agent_tools__submit_validation_response(validated=bool, errors=[])</code>  </p>
<p><strong>When Provided:</strong>  </p>
<ul>
<li>Validation agent checks task agent's work after each cycle</li>
<li>Returns success (<code>validated=True</code>) or failure (<code>validated=False</code>) with error list</li>
<li>Validation failures trigger retry with errors injected into next cycle's prompt</li>
<li>Validation success completes the action</li>
</ul>
<h3 id="max_cycles-optional">max_cycles (optional)<a class="headerlink" href="#max_cycles-optional" title="Permanent link">&para;</a></h3>
<p>Maximum number of retry cycles if transformation fails validation.</p>
<p><strong>Type:</strong> <code>integer</code>  </p>
<p><strong>Default:</strong> <code>3</code>  </p>
<p><strong>Behavior:</strong>  </p>
<ul>
<li>Each cycle runs: Planning (if enabled) → Task → Validation (if enabled)</li>
<li>Logs warning at 60% of max cycles (e.g., "Cycle 3 of 5, approaching max_cycles limit")</li>
<li>If all cycles exhausted, triggers <code>on_failure</code> action (if configured)</li>
<li>Error context from validation failures passed to subsequent cycles</li>
</ul>
<h3 id="on_failure-optional">on_failure (optional)<a class="headerlink" href="#on_failure-optional" title="Permanent link">&para;</a></h3>
<p>Action name to restart from if this action fails after all retry cycles.</p>
<p><strong>Type:</strong> <code>string</code> (action name)  </p>
<h3 id="ai_commit-optional">ai_commit (optional)<a class="headerlink" href="#ai_commit-optional" title="Permanent link">&para;</a></h3>
<p>Whether to use AI-generated commit messages for changes made by this action.</p>
<p><strong>Type:</strong> <code>boolean</code>  </p>
<p><strong>Default:</strong> <code>true</code>  </p>
<h2 id="planning-agent-feature">Planning Agent Feature<a class="headerlink" href="#planning-agent-feature" title="Permanent link">&para;</a></h2>
<p>The planning agent is an optional pre-execution analysis phase that explores the codebase before the task agent makes changes. This provides better context, structured execution, and improved success rates for complex transformations.</p>
<h3 id="when-to-use-planning">When to Use Planning<a class="headerlink" href="#when-to-use-planning" title="Permanent link">&para;</a></h3>
<p><strong>Use planning when:</strong>  </p>
<ul>
<li>Transformation requires analysis of multiple files</li>
<li>Dependencies or patterns need to be identified first</li>
<li>Task complexity benefits from structured approach</li>
<li>You want AI to explore before modifying</li>
</ul>
<p><strong>Skip planning when:</strong>  </p>
<ul>
<li>Simple, single-file modifications</li>
<li>Task is straightforward and well-defined</li>
<li>Speed is more important than thorough analysis</li>
</ul>
<h3 id="planning-workflow">Planning Workflow<a class="headerlink" href="#planning-workflow" title="Permanent link">&para;</a></h3>
<p><strong>Per-Cycle Execution:</strong>  </p>
<ol>
<li><strong>Planning Phase</strong> (if <code>planning_prompt</code> configured):</li>
<li>Planning agent uses read-only tools (Read, Glob, Grep, Bash)</li>
<li>Analyzes codebase structure, dependencies, patterns</li>
<li>Creates structured plan with specific, actionable task strings</li>
<li>Returns <code>{plan: [...], analysis: "..."}</code></li>
<li>
<p>Plan cleared and regenerated at start of each cycle</p>
</li>
<li>
<p><strong>Task Phase</strong>:</p>
</li>
<li>Task agent receives plan injected into prompt via <code>with-plan.md.j2</code> template</li>
<li>Follows numbered plan with full context from analysis</li>
<li>Uses write tools (Read, Write, Edit, Bash)</li>
<li>Works in <code>working_directory/repository/</code> directory</li>
<li>
<p>Can access <code>../workflow/</code> and <code>../extracted/</code> directories</p>
</li>
<li>
<p><strong>Validation Phase</strong> (if <code>validation_prompt</code> configured):</p>
</li>
<li>Validation agent verifies task agent's work</li>
<li>Returns <code>{validated: bool, errors: [...]}</code></li>
<li>Errors injected into next cycle if validation fails</li>
</ol>
<h3 id="planning-error-handling">Planning Error Handling<a class="headerlink" href="#planning-error-handling" title="Permanent link">&para;</a></h3>
<p><strong>When planning fails:</strong> Cycle aborts immediately (no task execution)  </p>
<p><strong>When validation fails:</strong>  </p>
<ul>
<li>Planning agent receives <code>planning-with-errors.md.j2</code> template</li>
<li>Explicitly instructed to create NEW PLAN (not fix errors directly)</li>
<li>Re-analyzes with context of what failed previously</li>
</ul>
<p><strong>Critical Fix (commit 561909f):</strong></p>
<ul>
<li>Planning agent was incorrectly trying to fix errors itself</li>
<li>Now properly re-plans based on validation failures</li>
<li>Creates new strategy each cycle</li>
</ul>
<h3 id="example-with-planning">Example with Planning<a class="headerlink" href="#example-with-planning" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">[[actions]]</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;migrate-to-pydantic-v2&quot;</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;claude&quot;</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="n">planning_prompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;prompts/planning.md.j2&quot;</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="n">task_prompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;prompts/task.md.j2&quot;</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="n">validation_prompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;prompts/validate.md.j2&quot;</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="n">max_cycles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span>
</code></pre></div>
<p><strong>Planning Prompt (<code>prompts/planning.md.j2</code>):</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="gh"># Analyze Pydantic Usage</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>Analyze this codebase to identify all Pydantic v1 usage.
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="gu">## Analysis Tasks</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="k">1.</span> Find all files importing from <span class="sb">`pydantic`</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="k">2.</span> Identify Pydantic models (classes inheriting BaseModel)
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="k">3.</span> Locate validators using <span class="sb">`@validator`</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="k">4.</span> Find <span class="sb">`.dict()`</span> and <span class="sb">`.json()`</span> method calls
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="k">5.</span> Identify Config classes that need migration
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="gu">## Output</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>Return a structured plan with:
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="k">-</span><span class="w"> </span>Specific files to update
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="k">-</span><span class="w"> </span>Order of operations (dependencies first)
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="k">-</span><span class="w"> </span>Potential breaking changes to watch for
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>Be thorough in your analysis. Check recursively in all Python files.
</code></pre></div></p>
<p><strong>Task Prompt (<code>prompts/task.md.j2</code>):</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="gh"># Migrate to Pydantic V2</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>Follow the plan provided to migrate this codebase from Pydantic v1 to v2.
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>Execute each task in order, making the necessary changes.
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>Ensure all imports, validators, and method calls are updated.
</code></pre></div></p>
<p><strong>Validation Prompt (<code>prompts/validate.md.j2</code>):</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="gh"># Validate Pydantic V2 Migration</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>Verify the migration was successful:
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="k">1.</span> Check all imports use Pydantic v2 syntax
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="k">2.</span> Verify Config classes converted to model_config
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="k">3.</span> Confirm validators use field_validator
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="k">4.</span> Ensure .dict()/.json() replaced with .model_dump()/.model_dump_json()
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="k">5.</span> Run tests if they exist
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>Return validated=true if all checks pass, otherwise list specific errors.
</code></pre></div></p>
<h2 id="prompt-context">Prompt Context<a class="headerlink" href="#prompt-context" title="Permanent link">&para;</a></h2>
<p>Prompts have access to all workflow context variables:</p>
<table>
<thead>
<tr>
<th>Variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>workflow</code></td>
<td>Workflow configuration</td>
</tr>
<tr>
<td><code>imbi_project</code></td>
<td>Imbi project data</td>
</tr>
<tr>
<td><code>github_repository</code></td>
<td>GitHub repository (if applicable)</td>
</tr>
<tr>
<td><code>working_directory</code></td>
<td>Execution directory path (task agent runs in <code>repository/</code> subdirectory)</td>
</tr>
<tr>
<td><code>starting_commit</code></td>
<td>Initial commit SHA</td>
</tr>
<tr>
<td><code>commit_author</code></td>
<td>Git commit author string (e.g., "Name <email>")</td>
</tr>
<tr>
<td><code>commit_author_name</code></td>
<td>Git author name (from <code>git.user_name</code>)</td>
</tr>
<tr>
<td><code>commit_author_address</code></td>
<td>Git author email (from <code>git.user_email</code>)</td>
</tr>
<tr>
<td><code>workflow_name</code></td>
<td>Current workflow name</td>
</tr>
</tbody>
</table>
<h2 id="examples">Examples<a class="headerlink" href="#examples" title="Permanent link">&para;</a></h2>
<h3 id="basic-code-transformation-without-planning">Basic Code Transformation (Without Planning)<a class="headerlink" href="#basic-code-transformation-without-planning" title="Permanent link">&para;</a></h3>
<p><strong>Workflow config:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">[[actions]]</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;update-python-version&quot;</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;claude&quot;</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="n">task_prompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;prompts/update-python.md&quot;</span>
</code></pre></div></p>
<p><strong>Prompt (<code>prompts/update-python.md</code>):</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="gh"># Update Python Version to 3.12</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>Update all Python version references in this repository to Python 3.12.
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="gu">## Files to Update</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="k">1.</span> <span class="sb">`pyproject.toml`</span> - Update <span class="sb">`requires-python`</span> field
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="k">2.</span> <span class="sb">`.github/workflows/*.yml`</span> - Update GitHub Actions Python version
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="k">3.</span> <span class="sb">`Dockerfile`</span> - Update base image to python:3.12
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="k">4.</span> <span class="sb">`README.md`</span> - Update installation instructions if they mention Python version
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="gu">## Requirements</span>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="k">-</span><span class="w"> </span>Maintain backwards compatibility where possible
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="k">-</span><span class="w"> </span>Update all version strings consistently
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="k">-</span><span class="w"> </span>Preserve existing configuration structure
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="k">-</span><span class="w"> </span>Do not modify other unrelated settings
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="gu">## Project Context</span>
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a>
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a><span class="k">-</span><span class="w"> </span><span class="gs">**Project**</span>: {{ imbi_project.name }}
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a><span class="k">-</span><span class="w"> </span><span class="gs">**Type**</span>: {{ imbi_project.project_type }}
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a><span class="k">-</span><span class="w"> </span><span class="gs">**Current Python**</span>: {{ imbi_project.facts.get(&#39;Programming Language&#39;, &#39;unknown&#39;) }}
<a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a>
<a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a><span class="gu">## Success Criteria</span>
<a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a>
<a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a>Create a commit with all Python version references updated to 3.12.
<a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a>
<a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a><span class="gu">## Failure Indication</span>
<a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a>
<a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a>If you cannot complete this task, return failure with details about what prevented completion.
</code></pre></div></p>
<h3 id="multi-cycle-transformation-with-retry">Multi-Cycle Transformation with Retry<a class="headerlink" href="#multi-cycle-transformation-with-retry" title="Permanent link">&para;</a></h3>
<p><strong>Workflow config:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="k">[[actions]]</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;refactor-codebase&quot;</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;claude&quot;</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="n">task_prompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;prompts/refactor.md&quot;</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="n">max_cycles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="n">on_failure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;create-issue&quot;</span><span class="w">  </span><span class="c1"># Create GitHub issue if fails</span>
</code></pre></div></p>
<h3 id="with-validator-no-planning">With Validator (No Planning)<a class="headerlink" href="#with-validator-no-planning" title="Permanent link">&para;</a></h3>
<p><strong>Workflow config:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="k">[[actions]]</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;update-dependencies&quot;</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;claude&quot;</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="n">task_prompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;prompts/update-deps.md&quot;</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="n">validation_prompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;prompts/validate-deps.md&quot;</span>
</code></pre></div></p>
<p><strong>Validator prompt:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="gh"># Validate Dependency Updates</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>Verify that the dependency updates were successful:
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="k">1.</span> Check that <span class="sb">`requirements.txt`</span> or <span class="sb">`pyproject.toml`</span> has been updated
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="k">2.</span> Verify no breaking changes were introduced
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="k">3.</span> Confirm all imports still resolve correctly
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="k">4.</span> Check that version constraints are reasonable
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>Return success if validation passes, failure otherwise with specific errors.
</code></pre></div></p>
<h3 id="complex-transformation-without-planning">Complex Transformation (Without Planning)<a class="headerlink" href="#complex-transformation-without-planning" title="Permanent link">&para;</a></h3>
<p><strong>Workflow config:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="k">[[actions]]</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;migrate-to-pydantic-v2&quot;</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;claude&quot;</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="n">task_prompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;prompts/pydantic-migration.md&quot;</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="n">max_cycles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span>
</code></pre></div></p>
<p><strong>Task Prompt:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="gh"># Migrate to Pydantic V2</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>Migrate this codebase from Pydantic v1 to Pydantic v2.
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="gu">## Migration Steps</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="k">1.</span> <span class="gs">**Update imports**</span>: Change <span class="sb">`pydantic`</span> imports to v2 syntax
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="k">2.</span> <span class="gs">**Config classes**</span>: Convert <span class="sb">`Config`</span> class to <span class="sb">`model_config`</span> dict
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="k">3.</span> <span class="gs">**Validators**</span>: Update <span class="sb">`@validator`</span> to <span class="sb">`@field_validator`</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="k">4.</span> <span class="gs">**Field definitions**</span>: Update <span class="sb">`Field(...)`</span> syntax changes
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="k">5.</span> <span class="gs">**JSON methods**</span>: Replace <span class="sb">`.dict()`</span> with <span class="sb">`.model_dump()`</span>, <span class="sb">`.json()`</span> with <span class="sb">`.model_dump_json()`</span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="gu">## Files to Process</span>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>Scan the repository for Python files containing:
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a><span class="k">-</span><span class="w"> </span><span class="sb">`from pydantic import`</span>
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a><span class="k">-</span><span class="w"> </span><span class="sb">`class.*\\(.*BaseModel\\)`</span>
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a><span class="k">-</span><span class="w"> </span><span class="sb">`@validator`</span>
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a><span class="k">-</span><span class="w"> </span><span class="sb">`.dict()`</span> or <span class="sb">`.json()`</span> calls on Pydantic models
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a>
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a><span class="gu">## Testing</span>
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a>
<a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a>After making changes:
<a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a><span class="k">1.</span> Run tests if they exist: <span class="sb">`pytest tests/`</span>
<a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a><span class="k">2.</span> Check for import errors
<a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a><span class="k">3.</span> Verify all models still validate correctly
<a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a>
<a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a><span class="gu">## Commit Message</span>
<a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a>
<a id="__codelineno-11-30" name="__codelineno-11-30" href="#__codelineno-11-30"></a>````
<a id="__codelineno-11-31" name="__codelineno-11-31" href="#__codelineno-11-31"></a>Migrate from Pydantic v1 to v2
<a id="__codelineno-11-32" name="__codelineno-11-32" href="#__codelineno-11-32"></a>
<a id="__codelineno-11-33" name="__codelineno-11-33" href="#__codelineno-11-33"></a><span class="k">-</span><span class="w"> </span>Update imports to v2 syntax
<a id="__codelineno-11-34" name="__codelineno-11-34" href="#__codelineno-11-34"></a><span class="k">-</span><span class="w"> </span>Convert Config classes to model_config
<a id="__codelineno-11-35" name="__codelineno-11-35" href="#__codelineno-11-35"></a><span class="k">-</span><span class="w"> </span>Update validators to field_validator
<a id="__codelineno-11-36" name="__codelineno-11-36" href="#__codelineno-11-36"></a><span class="k">-</span><span class="w"> </span>Replace .dict()/.json() with .model_dump()/.model_dump_json()
<a id="__codelineno-11-37" name="__codelineno-11-37" href="#__codelineno-11-37"></a>
<a id="__codelineno-11-38" name="__codelineno-11-38" href="#__codelineno-11-38"></a>Project: {{ imbi_project.name }}
<a id="__codelineno-11-39" name="__codelineno-11-39" href="#__codelineno-11-39"></a>````
<a id="__codelineno-11-40" name="__codelineno-11-40" href="#__codelineno-11-40"></a>
<a id="__codelineno-11-41" name="__codelineno-11-41" href="#__codelineno-11-41"></a><span class="gu">## Failure Conditions</span>
<a id="__codelineno-11-42" name="__codelineno-11-42" href="#__codelineno-11-42"></a>
<a id="__codelineno-11-43" name="__codelineno-11-43" href="#__codelineno-11-43"></a>Return failure if:
<a id="__codelineno-11-44" name="__codelineno-11-44" href="#__codelineno-11-44"></a><span class="k">-</span><span class="w"> </span>Unable to identify Pydantic usage patterns
<a id="__codelineno-11-45" name="__codelineno-11-45" href="#__codelineno-11-45"></a><span class="k">-</span><span class="w"> </span>Migration would break existing functionality
<a id="__codelineno-11-46" name="__codelineno-11-46" href="#__codelineno-11-46"></a><span class="k">-</span><span class="w"> </span>Tests fail after migration
<a id="__codelineno-11-47" name="__codelineno-11-47" href="#__codelineno-11-47"></a><span class="k">-</span><span class="w"> </span>Manual intervention required
<a id="__codelineno-11-48" name="__codelineno-11-48" href="#__codelineno-11-48"></a>
<a id="__codelineno-11-49" name="__codelineno-11-49" href="#__codelineno-11-49"></a>Include specific error details and affected files in the failure response.
</code></pre></div></p>
<h2 id="prompt-best-practices">Prompt Best Practices<a class="headerlink" href="#prompt-best-practices" title="Permanent link">&para;</a></h2>
<h3 id="clear-objectives">Clear Objectives<a class="headerlink" href="#clear-objectives" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="gh"># Update Docker Base Image</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="gs">**Goal**</span>: Update the Dockerfile to use python:3.12-slim as the base image.
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="gs">**Files**</span>: <span class="sb">`Dockerfile`</span>, <span class="sb">`docker-compose.yml`</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="gs">**Requirements**</span>:
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="k">-</span><span class="w"> </span>Change base image in all Dockerfiles
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="k">-</span><span class="w"> </span>Maintain multi-stage build structure if present
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="k">-</span><span class="w"> </span>Update docker-compose.yml references
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="k">-</span><span class="w"> </span>Keep existing COPY, RUN, CMD instructions
</code></pre></div>
<h3 id="specific-instructions">Specific Instructions<a class="headerlink" href="#specific-instructions" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="gu">## Step-by-Step Process</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="k">1.</span> Locate all Dockerfile* files in the repository
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="k">2.</span> For each Dockerfile:
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>   a. Find the <span class="sb">`FROM`</span> instruction
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>   b. Replace with <span class="sb">`FROM python:3.12-slim`</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>   c. Keep any <span class="sb">`AS builder`</span> or stage names
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="k">3.</span> Update docker-compose.yml if it hardcodes Python version
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="k">4.</span> Commit changes with message: &quot;Update Python base image to 3.12&quot;
</code></pre></div>
<h3 id="successfailure-criteria">Success/Failure Criteria<a class="headerlink" href="#successfailure-criteria" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="gu">## Success Criteria</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>You must:
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>✓ Update all Dockerfiles  
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>✓ Maintain working configuration  
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>✓ Create a git commit  
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>✓ Include descriptive commit message  
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="gu">## Failure Indication</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>Return failure if:
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="k">-</span><span class="w"> </span>No Dockerfile found in repository
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="k">-</span><span class="w"> </span>Unable to parse existing Dockerfile syntax
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="k">-</span><span class="w"> </span>Changes would break the build process
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="k">-</span><span class="w"> </span>Multiple conflicting Dockerfile versions exist
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>Include the specific error and list of files examined in the failure response.
</code></pre></div>
<h3 id="project-context-usage">Project Context Usage<a class="headerlink" href="#project-context-usage" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="gu">## Project-Specific Considerations</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="k">-</span><span class="w"> </span><span class="gs">**Project**</span>: {{ imbi_project.name }}
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="k">-</span><span class="w"> </span><span class="gs">**Type**</span>: {{ imbi_project.project_type }}
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="k">-</span><span class="w"> </span><span class="gs">**Namespace**</span>: {{ imbi_project.namespace }}
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>{% if imbi_project.project_type == &#39;api&#39; %}
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>This is an API project - ensure uvicorn/fastapi configurations are preserved.
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>{% elif imbi_project.project_type == &#39;consumer&#39; %}
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>This is a consumer - ensure message handling configurations are intact.
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>{% endif %}
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>{% if imbi_project.facts %}
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="gu">## Known Facts</span>
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>{% for key, value in imbi_project.facts.items() %}
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a><span class="k">-</span><span class="w"> </span><span class="gs">**{{ key }}**</span>: {{ value }}
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a>{% endfor %}
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a>{% endif %}
</code></pre></div>
<h2 id="failure-handling">Failure Handling<a class="headerlink" href="#failure-handling" title="Permanent link">&para;</a></h2>
<h3 id="failure-files">Failure Files<a class="headerlink" href="#failure-files" title="Permanent link">&para;</a></h3>
<p>Claude actions detect failure through specific files created in the working directory:</p>
<table>
<thead>
<tr>
<th>File Name</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ACTION_FAILED</code></td>
<td>Generic action failure</td>
</tr>
<tr>
<td><code>{ACTION_NAME}_FAILED</code></td>
<td>Specific action failure</td>
</tr>
<tr>
<td>Custom names</td>
<td>Custom failure indicators</td>
</tr>
</tbody>
</table>
<p><strong>Prompt instructions for failure:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="gu">## Failure Indication</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>If you cannot complete this task, return failure with:
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="k">1.</span> <span class="gs">**Reason**</span>: Why the task failed
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="k">2.</span> <span class="gs">**Files Examined**</span>: List of files you checked
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="k">3.</span> <span class="gs">**Errors Encountered**</span>: Specific error messages
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="k">4.</span> <span class="gs">**Manual Steps**</span>: What a human would need to do
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="k">5.</span> <span class="gs">**Context**</span>: Any relevant information for debugging
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>Example failure response:
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>````
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a>Unable to parse pyproject.toml due to syntax error
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a>Files examined: pyproject.toml, requirements.txt
<a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a>Error: toml.decoder.TomlDecodeError at line 15
<a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a>Manual steps: Fix toml syntax error in pyproject.toml line 15
<a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a>````
</code></pre></div></p>
<h3 id="retry-mechanism">Retry Mechanism<a class="headerlink" href="#retry-mechanism" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="k">[[actions]]</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;fragile-transformation&quot;</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;claude&quot;</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="n">prompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;prompts/transform.md&quot;</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="n">max_cycles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="w">        </span><span class="c1"># Try up to 5 times</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="n">on_failure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;cleanup&quot;</span><span class="w"> </span><span class="c1"># Run cleanup action if all cycles fail</span>
</code></pre></div>
<p><strong>Cycle behavior:</strong>  </p>
<ol>
<li>Execute transformation</li>
<li>Check for failure files</li>
<li>If failure detected and cycles remaining, retry</li>
<li>If all cycles exhausted, trigger <code>on_failure</code> action</li>
<li>Pass error context to retry attempts</li>
</ol>
<h3 id="error-context-in-retries">Error Context in Retries<a class="headerlink" href="#error-context-in-retries" title="Permanent link">&para;</a></h3>
<p>On retry, the prompt receives additional context:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="c1"># Appended to prompt automatically:</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="sd">---</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="sd">You need to fix problems identified from a previous run.</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="sd">The errors for context are:</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="sd">{</span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="sd">  &quot;result&quot;: &quot;failure&quot;,</span>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="sd">  &quot;message&quot;: &quot;Unable to update dependencies&quot;,</span>
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="sd">  &quot;errors&quot;: [&quot;Package X not found&quot;, &quot;Version conflict with Y&quot;]</span>
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="sd">}</span>
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
<h2 id="advanced-usage">Advanced Usage<a class="headerlink" href="#advanced-usage" title="Permanent link">&para;</a></h2>
<h3 id="conditional-prompts">Conditional Prompts<a class="headerlink" href="#conditional-prompts" title="Permanent link">&para;</a></h3>
<p><strong>Workflow:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="k">[[actions]]</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;language-specific-update&quot;</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;claude&quot;</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="n">task_prompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;prompts/{{ imbi_project.facts.get(&#39;Programming Language&#39;, &#39;unknown&#39;) | lower }}-update.md&quot;</span>
</code></pre></div></p>
<h3 id="multi-stage-transformations">Multi-Stage Transformations<a class="headerlink" href="#multi-stage-transformations" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="k">[[actions]]</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;stage1-refactor&quot;</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;claude&quot;</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="n">task_prompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;prompts/stage1.md&quot;</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="k">[[actions]]</span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;stage2-optimize&quot;</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;claude&quot;</span>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="n">task_prompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;prompts/stage2.md&quot;</span>
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="k">[[actions]]</span>
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;stage3-document&quot;</span>
<a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;claude&quot;</span>
<a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a><span class="n">task_prompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;prompts/stage3.md&quot;</span>
</code></pre></div>
<h3 id="with-prepost-actions">With Pre/Post Actions<a class="headerlink" href="#with-prepost-actions" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="k">[[actions]]</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;backup-files&quot;</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;file&quot;</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;copy&quot;</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="n">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;repository:///src/&quot;</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="n">destination</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;repository:///src.backup/&quot;</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="k">[[actions]]</span>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ai-refactor&quot;</span>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;claude&quot;</span>
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="n">task_prompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;prompts/refactor.md&quot;</span>
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="n">on_failure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;restore-backup&quot;</span>
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a>
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a><span class="k">[[actions]]</span>
<a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;run-tests&quot;</span>
<a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;shell&quot;</span>
<a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;pytest tests/&quot;</span>
<a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a><span class="n">working_directory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;repository:///&quot;</span>
<a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a>
<a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a><span class="k">[[actions]]</span>
<a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;restore-backup&quot;</span>
<a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;file&quot;</span>
<a id="__codelineno-21-23" name="__codelineno-21-23" href="#__codelineno-21-23"></a><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;move&quot;</span>
<a id="__codelineno-21-24" name="__codelineno-21-24" href="#__codelineno-21-24"></a><span class="n">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;repository:///src.backup/&quot;</span>
<a id="__codelineno-21-25" name="__codelineno-21-25" href="#__codelineno-21-25"></a><span class="n">destination</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;repository:///src/&quot;</span>
</code></pre></div>
<h2 id="integration-with-other-actions">Integration with Other Actions<a class="headerlink" href="#integration-with-other-actions" title="Permanent link">&para;</a></h2>
<h3 id="claude-shell-test-verification">Claude + Shell (Test Verification)<a class="headerlink" href="#claude-shell-test-verification" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="k">[[actions]]</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ai-code-update&quot;</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;claude&quot;</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="n">task_prompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;prompts/update.md&quot;</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="k">[[actions]]</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;verify-tests&quot;</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;shell&quot;</span>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;pytest tests/ -v&quot;</span>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="n">working_directory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;repository:///&quot;</span>
</code></pre></div>
<h3 id="claude-file-template-application">Claude + File (Template Application)<a class="headerlink" href="#claude-file-template-application" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="k">[[actions]]</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;generate-base-config&quot;</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;template&quot;</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="n">source_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;config.yaml.j2&quot;</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="n">destination_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;repository:///config.yaml&quot;</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="k">[[actions]]</span>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;customize-config&quot;</span>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;claude&quot;</span>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="n">task_prompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;prompts/customize-config.md&quot;</span>
</code></pre></div>
<h3 id="claude-git-commit-verification">Claude + Git (Commit Verification)<a class="headerlink" href="#claude-git-commit-verification" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="k">[[actions]]</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ai-transformation&quot;</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;claude&quot;</span>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="n">task_prompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;prompts/transform.md&quot;</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="k">[[actions]]</span>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;verify-commit&quot;</span>
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;shell&quot;</span>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;git log -1 --pretty=%B&quot;</span>
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a><span class="n">working_directory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;repository:///&quot;</span>
</code></pre></div>
<h2 id="mcp-servers">MCP Servers<a class="headerlink" href="#mcp-servers" title="Permanent link">&para;</a></h2>
<p>Claude actions automatically have access to MCP (Model Context Protocol) servers configured at the workflow level. These servers provide Claude with tools to access external data sources and APIs during task execution.</p>
<h3 id="configuration_1">Configuration<a class="headerlink" href="#configuration_1" title="Permanent link">&para;</a></h3>
<p>MCP servers are configured in the workflow's <code>config.toml</code> file under the <code>[mcp_servers]</code> section. See <a href="../../workflow-configuration/#mcp-server-configuration">MCP Server Configuration</a> for full documentation.</p>
<h3 id="available-servers">Available Servers<a class="headerlink" href="#available-servers" title="Permanent link">&para;</a></h3>
<p>During Claude action execution, the following MCP servers are available:</p>
<ol>
<li><strong><code>agent_tools</code></strong> (built-in): Provides workflow submission functions:</li>
<li><code>mcp__agent_tools__submit_planning_response()</code> - For planning agents</li>
<li><code>mcp__agent_tools__submit_task_response()</code> - For task agents</li>
<li>
<p><code>mcp__agent_tools__submit_validation_response()</code> - For validation agents</p>
</li>
<li>
<p><strong>Workflow-configured servers</strong>: Any MCP servers defined in <code>[mcp_servers.*]</code> sections</p>
</li>
</ol>
<h3 id="example-database-access">Example: Database Access<a class="headerlink" href="#example-database-access" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="c1"># Workflow config.toml</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="k">[mcp_servers.postgres]</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;stdio&quot;</span>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;uvx&quot;</span>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="n">args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;mcp-server-postgres&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;${DATABASE_URL}&quot;</span><span class="p">]</span>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="k">[[actions]]</span>
<a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;analyze-schema&quot;</span>
<a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;claude&quot;</span>
<a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="n">task_prompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;prompts/analyze-schema.md&quot;</span>
</code></pre></div>
<p><strong>Prompt (<code>prompts/analyze-schema.md</code>):</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="gh"># Analyze Database Schema</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>Use the postgres MCP server to analyze the database schema.
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="k">1.</span> List all tables in the database
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="k">2.</span> Identify relationships between tables
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="k">3.</span> Generate a summary of the schema structure
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a>
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>Use the <span class="sb">`mcp__postgres__*`</span> tools to query the database.
</code></pre></div></p>
<h3 id="environment-variables-in-mcp-configs">Environment Variables in MCP Configs<a class="headerlink" href="#environment-variables-in-mcp-configs" title="Permanent link">&para;</a></h3>
<p>MCP server configurations support shell-style environment variable expansion (<code>$VAR</code> or <code>${VAR}</code>) for secure credential injection. Variables are expanded at runtime when the Claude client is created.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="k">[mcp_servers.secure-api]</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;http&quot;</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;https://api.example.com/mcp&quot;</span>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="n">headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Authorization</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s2">&quot;Bearer ${API_TOKEN}&quot;</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<p>If a referenced environment variable is not set, a clear error is raised before execution begins.</p>
<h2 id="performance-considerations">Performance Considerations<a class="headerlink" href="#performance-considerations" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>API Costs</strong>: Each cycle makes Claude API calls</li>
<li><strong>Execution Time</strong>: Complex transformations can take several minutes</li>
<li><strong>Context Size</strong>: Large repositories may hit context limits</li>
<li><strong>Rate Limiting</strong>: Respect Anthropic API rate limits</li>
</ul>
<h2 id="security-considerations">Security Considerations<a class="headerlink" href="#security-considerations" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Code Execution</strong>: Claude can execute arbitrary code in the repository context</li>
<li><strong>Sensitive Data</strong>: Prompts and code are sent to Anthropic API</li>
<li><strong>API Keys</strong>: Ensure API keys are properly secured</li>
<li><strong>Verification</strong>: Always verify AI-generated changes before merging</li>
</ul>
<h2 id="implementation-notes">Implementation Notes<a class="headerlink" href="#implementation-notes" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Module:</strong> <code>src/imbi_automations/actions/claude.py</code> and <code>src/imbi_automations/claude.py</code></li>
<li><strong>Models:</strong> <code>src/imbi_automations/models/claude.py</code> (agent types, response models)</li>
<li><strong>Tests:</strong> <code>tests/test_claude.py</code> and <code>tests/actions/test_claude.py</code> (376 passing tests)</li>
<li><strong>Working Directory:</strong> Task agent runs in <code>working_directory/repository/</code> subdirectory</li>
<li><strong>Agent Locations:</strong> <code>claude-code/agents/{planning,task,validation}.md.j2</code></li>
<li><strong>Prompt Templates:</strong> <code>actions/prompts/{with-plan,planning-with-errors,last-error}.md.j2</code></li>
<li><strong>Tool Submission:</strong> Agents use MCP agent_tools for structured responses</li>
<li><strong>Automatic Cleanup:</strong> Working directories cleaned on success or failure</li>
<li><strong>Full Logging:</strong> Claude API interactions logged at DEBUG level</li>
<li><strong>Cycle Warning:</strong> Warning logged at 60% of max_cycles (e.g., cycle 3 of 5)</li>
<li><strong>Error Categorization:</strong> Failures categorized as dependency_unavailable, constraint_conflict, prohibited_action, test_failure, or unknown</li>
</ul>
<p><strong>Recent Critical Fixes (October 2025):</strong>
1. <strong>Planning Agent Error Handling</strong> (commit 561909f): Fixed planning agent to create NEW PLAN instead of fixing errors directly when validation fails
2. <strong>Claude SDK CWD Fix</strong> (commit 561909f): Changed working directory from root to <code>repository/</code> subdirectory for correct file operations
3. <strong>preserve_on_error Fix</strong> (commit 561909f): Fixed unreachable preservation code, now properly saves error states
4. <strong>Test Suite Update</strong> (commit 561909f): Fixed 28 broken tests, all 376 tests now passing</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright 2025 - AWeber
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.sections", "navigation.expand", "navigation.top", "navigation.tabs", "search.suggest", "search.highlight", "content.code.copy"], "search": "../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>